{"version":3,"sources":["../Ocelot.js"],"names":["isExternal","url","match","length","toLowerCase","location","protocol","replace","RegExp","host","Pjax","el","events","defaultOpts","endpoint","method","timeout","callback","callbackTimeout","push","prePopCallback","postPopCallback","registerPop","self","history","pushState","window","onpopstate","popOpts","pathname","changePage","console","warn","event","customOpts","opts","Object","keys","forEach","key","xhr","XMLHttpRequest","open","send","onreadystatechange","readyState","status","setTimeout","temp","document","createElement","innerHTML","responseText","querySelector","pageEvent","addEventListener","e","target","srcElement","HTMLAnchorElement","attributes","value","split","indexOf","preventDefault","parentNode","fadeTo","fadeContent","getElementById","style","transition","passedCallback","data","opacity"],"mappings":"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","file":"Ocelot.js","sourcesContent":["const isExternal = (url) => {\n    let match = url.match(/^([^:\\/?#]+:)?(?:\\/\\/([^\\/?#]*))?([^?#]+)?(\\?[^#]*)?(#.*)?/);\n    if(typeof match[1] === 'string' && match[1].length > 0 && match[1].toLowerCase() !== location.protocol) return true;\n    if(typeof match[2] === 'string' && match[2].length > 0 && match[2].replace(new RegExp(':('+{'http:':80,'https:':443}[location.protocol]+')?$'), '') !== location.host) return true;\n    return false;\n};\n\nclass Pjax {\n    constructor(el = 'ocelot-content') {\n        // The element to watch\n        this.el = el;\n\n        // Page-specific events\n        this.events = {};\n\n        // Default changePage options\n        this.defaultOpts = {endpoint: false, method: 'GET', timeout: 0, callback: null, callbackTimeout: 0, push: true};\n\n        // Default pop callbacks\n        this.prePopCallback = () => {\n        };\n        this.postPopCallback = null;\n\n        // Register pop state events\n        this.registerPop();\n    }\n\n    registerPop() {\n        let self = this;\n\n        if(history.pushState) {\n            window.onpopstate = () => {\n                let popOpts = {\n                    endpoint : window.location.pathname,\n                    push: false\n                };\n\n                // Change page without pushing new entry to the history\n                if(self.prePopCallback) this.prePopCallback();\n                if(self.postPopCallback) popOpts.callback = this.postPopCallback;\n                self.changePage(popOpts);\n            };\n        } else {\n            console.warn('Ocelot: this browser does not support history.pushState. Hash changing is coming soon.');\n        }\n    }\n\n    setEvent(url, event) {\n        this.events[url] = event;\n    }\n\n    changePage(customOpts = {}) {\n        let opts = this.defaultOpts;\n\n        Object.keys(customOpts).forEach((key) => {\n            opts[key] = customOpts[key];\n        });\n\n        if(!opts.endpoint) console.warn('Ocelot: a PJAX endpoint is required.');\n\n        // AJAX call made to endpoint\n        let xhr = new XMLHttpRequest();\n        xhr.open(opts.method, opts.endpoint, true);\n        xhr.send();\n        xhr.onreadystatechange = () => {\n            if(xhr.readyState !== 4) return;\n            if(xhr.status !== 200) {\n                console.warn(`Ocelot: ${opts.method} ${opts.endpoint} returned ${xhr.status}.`);\n                return;\n            }\n\n            // Set a timeout in case of any transition animations\n            setTimeout(() => {\n                // Get only AJAX-friendly content, we don't want to duplicate the CSS and JavaScript\n                let temp = document.createElement('div');\n                temp.innerHTML = xhr.responseText;\n                document.querySelector(`#${this.el}`).innerHTML = temp.querySelector(`#${this.el}`).innerHTML;\n\n                // Perform any page-specific events\n                let pageEvent = this.events[opts.endpoint];\n                if(pageEvent) {\n                    if(typeof pageEvent !== 'function') {\n                        console.warn(`Ocelot: ${opts.endpoint} event must be a function, instead found ${typeof pageEvent}.`);\n                        return;\n                    }\n                    pageEvent();\n                }\n            }, opts.timeout);\n\n            // Perform callback function (if any)\n            setTimeout(function(){\n                if(opts.callback === null) return;\n                if(typeof opts.callback !== 'function') {\n                    console.warn(`Ocelot: Callback must be a function, instead found ${typeof opts.callback}.`);\n                    return;\n                }\n\n                opts.callback(xhr.responseText);\n            }, opts.callbackTimeout);\n\n            // Push to browser history to allow for back/forward\n            if(opts.push) history.pushState('', 'New URL: ' + opts.endpoint, opts.endpoint);\n        };\n    }\n\n    all(opts = {}) {\n        document.addEventListener('click', (e) => {\n            e = e || window.event;\n            let target = e.target || e.srcElement;\n\n            // Bubble up through the DOM to target links\n            while(target) {\n                if (target instanceof HTMLAnchorElement) {\n                    opts.endpoint = target.attributes['href'].value;\n                    opts.push = true;\n\n                    let protocol = opts.endpoint.split(':')[0];\n                    if(['mailto', 'tel'].indexOf(protocol) !== -1) break;\n                    if(isExternal(opts.endpoint)) break;\n\n                    e.preventDefault();\n\n                    if(typeof opts.prePopCallback !== 'function') {\n                        this.prePopCallback();\n                    } else {\n                        opts.prePopCallback();\n                    }\n\n                    this.changePage(opts);\n                    break;\n                }\n\n                target = target.parentNode;\n            }\n        });\n    }\n\n    fadeAll(opts = {}) {\n        if(!opts.timeout) opts.timeout = 250;\n        if(!opts.callbackTimeout) opts.callbackTimeout = 250;\n        if(!opts.fadeTo) opts.fadeTo = 0;\n        if(!opts.prePopCallback) this.prePopCallback = () => { this.fadeContent(opts.fadeTo); };\n\n        document.getElementById(this.el).style.transition = 'opacity ' + opts.timeout/1000 + 's ease-out';\n\n\n\n        document.addEventListener('click', (e) => {\n            e = e || window.event;\n            let target = e.target || e.srcElement;\n\n            // Bubble up through the DOM to target links\n            while(target) {\n                if (target instanceof HTMLAnchorElement) {\n                    opts.endpoint = target.attributes['href'].value;\n                    opts.push = true;\n\n                    let protocol = opts.endpoint.split(':')[0];\n                    if(['mailto', 'tel'].indexOf(protocol) !== -1) break;\n                    if(isExternal(opts.endpoint)) break;\n\n                    e.preventDefault();\n\n                    this.fadeContent(opts.fadeTo);\n\n                    let passedCallback = opts.callback;\n                    opts.callback = (data) => {\n                        this.fadeContent(1);\n                        if(passedCallback) passedCallback(data);\n                    };\n\n                    this.postPopCallback = opts.callback;\n\n                    this.changePage(opts);\n                    break;\n                }\n\n                target = target.parentNode;\n            }\n        });\n\n\n    }\n\n    fadeContent(fadeTo) {\n        document.getElementById(this.el).style.opacity = fadeTo;\n    }\n}\n\nexport { Pjax };"]}