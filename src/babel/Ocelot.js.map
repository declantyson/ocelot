{"version":3,"sources":["../Ocelot.js"],"names":["Pjax","el","events","defaultOpts","endpoint","method","timeout","callback","callbackTimeout","push","prePopCallback","postPopCallback","registerPop","self","history","pushState","window","onpopstate","popOpts","location","pathname","changePage","console","warn","url","event","customOpts","opts","Object","keys","forEach","key","xhr","XMLHttpRequest","open","send","onreadystatechange","readyState","status","setTimeout","temp","document","createElement","innerHTML","responseText","querySelector","pageEvent","addEventListener","e","target","srcElement","HTMLAnchorElement","attributes","value","protocol","split","indexOf","isExternal","preventDefault","parentNode","fadeTo","fadeContent","getElementById","style","transition","passedCallback","data","opacity","match","length","toLowerCase","replace","RegExp","host"],"mappings":";;;;;;;;;;;;IAAMA,I;AACF,oBAAmC;AAAA,YAAvBC,EAAuB,uEAAlB,gBAAkB;;AAAA;;AAC/B;AACA,aAAKA,EAAL,GAAUA,EAAV;;AAEA;AACA,aAAKC,MAAL,GAAc,EAAd;;AAEA;AACA,aAAKC,WAAL,GAAmB,EAACC,UAAU,KAAX,EAAkBC,QAAQ,KAA1B,EAAiCC,SAAS,CAA1C,EAA6CC,UAAU,IAAvD,EAA6DC,iBAAiB,CAA9E,EAAiFC,MAAM,IAAvF,EAAnB;;AAEA;AACA,aAAKC,cAAL,GAAsB,YAAM,CAC3B,CADD;AAEA,aAAKC,eAAL,GAAuB,IAAvB;;AAEA;AACA,aAAKC,WAAL;AACH;;;;sCAEa;AAAA;;AACV,gBAAIC,OAAO,IAAX;;AAEA,gBAAGC,QAAQC,SAAX,EAAsB;AAClBC,uBAAOC,UAAP,GAAoB,YAAM;AACtB,wBAAIC,UAAU;AACVd,kCAAWY,OAAOG,QAAP,CAAgBC,QADjB;AAEVX,8BAAM;AAFI,qBAAd;;AAKA;AACA,wBAAGI,KAAKH,cAAR,EAAwB,MAAKA,cAAL;AACxB,wBAAGG,KAAKF,eAAR,EAAyBO,QAAQX,QAAR,GAAmB,MAAKI,eAAxB;AACzBE,yBAAKQ,UAAL,CAAgBH,OAAhB;AACH,iBAVD;AAWH,aAZD,MAYO;AACHI,wBAAQC,IAAR,CAAa,wFAAb;AACH;AACJ;;;iCAEQC,G,EAAKC,K,EAAO;AACjB,iBAAKvB,MAAL,CAAYsB,GAAZ,IAAmBC,KAAnB;AACH;;;qCAE2B;AAAA;;AAAA,gBAAjBC,UAAiB,uEAAJ,EAAI;;AACxB,gBAAIC,OAAO,KAAKxB,WAAhB;;AAEAyB,mBAAOC,IAAP,CAAYH,UAAZ,EAAwBI,OAAxB,CAAgC,UAACC,GAAD,EAAS;AACrCJ,qBAAKI,GAAL,IAAYL,WAAWK,GAAX,CAAZ;AACH,aAFD;;AAIA,gBAAG,CAACJ,KAAKvB,QAAT,EAAmBkB,QAAQC,IAAR,CAAa,sCAAb;;AAEnB;AACA,gBAAIS,MAAM,IAAIC,cAAJ,EAAV;AACAD,gBAAIE,IAAJ,CAASP,KAAKtB,MAAd,EAAsBsB,KAAKvB,QAA3B,EAAqC,IAArC;AACA4B,gBAAIG,IAAJ;AACAH,gBAAII,kBAAJ,GAAyB,YAAM;AAC3B,oBAAGJ,IAAIK,UAAJ,KAAmB,CAAtB,EAAyB;AACzB,oBAAGL,IAAIM,MAAJ,KAAe,GAAlB,EAAuB;AACnBhB,4BAAQC,IAAR,cAAwBI,KAAKtB,MAA7B,SAAuCsB,KAAKvB,QAA5C,kBAAiE4B,IAAIM,MAArE;AACA;AACH;;AAED;AACAC,2BAAW,YAAM;AACb;AACA,wBAAIC,OAAOC,SAASC,aAAT,CAAuB,KAAvB,CAAX;AACAF,yBAAKG,SAAL,GAAiBX,IAAIY,YAArB;AACAH,6BAASI,aAAT,OAA2B,OAAK5C,EAAhC,EAAsC0C,SAAtC,GAAkDH,KAAKK,aAAL,OAAuB,OAAK5C,EAA5B,EAAkC0C,SAApF;;AAEA;AACA,wBAAIG,YAAY,OAAK5C,MAAL,CAAYyB,KAAKvB,QAAjB,CAAhB;AACA,wBAAG0C,SAAH,EAAc;AACV,4BAAG,OAAOA,SAAP,KAAqB,UAAxB,EAAoC;AAChCxB,oCAAQC,IAAR,cAAwBI,KAAKvB,QAA7B,yDAAwF0C,SAAxF,yCAAwFA,SAAxF;AACA;AACH;AACDA;AACH;AACJ,iBAfD,EAeGnB,KAAKrB,OAfR;;AAiBA;AACAiC,2BAAW,YAAU;AACjB,wBAAGZ,KAAKpB,QAAL,KAAkB,IAArB,EAA2B;AAC3B,wBAAG,OAAOoB,KAAKpB,QAAZ,KAAyB,UAA5B,EAAwC;AACpCe,gCAAQC,IAAR,iEAA0EI,KAAKpB,QAA/E;AACA;AACH;;AAEDoB,yBAAKpB,QAAL,CAAcyB,IAAIY,YAAlB;AACH,iBARD,EAQGjB,KAAKnB,eARR;;AAUA;AACA,oBAAGmB,KAAKlB,IAAR,EAAcK,QAAQC,SAAR,CAAkB,EAAlB,EAAsB,cAAcY,KAAKvB,QAAzC,EAAmDuB,KAAKvB,QAAxD;AACjB,aAtCD;AAuCH;;;8BAEc;AAAA;;AAAA,gBAAXuB,IAAW,uEAAJ,EAAI;;AACXc,qBAASM,gBAAT,CAA0B,OAA1B,EAAmC,UAACC,CAAD,EAAO;AACtCA,oBAAIA,KAAKhC,OAAOS,KAAhB;AACA,oBAAIwB,SAASD,EAAEC,MAAF,IAAYD,EAAEE,UAA3B;;AAEA;AACA,uBAAMD,MAAN,EAAc;AACV,wBAAIA,kBAAkBE,iBAAtB,EAAyC;AACrCxB,6BAAKvB,QAAL,GAAgB6C,OAAOG,UAAP,CAAkB,MAAlB,EAA0BC,KAA1C;AACA,4BAAIC,WAAW3B,KAAKvB,QAAL,CAAcmD,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAAf;AACA,4BAAG,CAAC,QAAD,EAAW,KAAX,EAAkBC,OAAlB,CAA0BF,QAA1B,MAAwC,CAAC,CAA5C,EAA+C;AAC/C,4BAAGG,WAAW9B,KAAKvB,QAAhB,CAAH,EAA8B;;AAE9B4C,0BAAEU,cAAF;;AAEA,4BAAG,OAAO/B,KAAKjB,cAAZ,KAA+B,UAAlC,EAA8C;AAC1C,mCAAKA,cAAL;AACH,yBAFD,MAEO;AACHiB,iCAAKjB,cAAL;AACH;;AAED,+BAAKW,UAAL,CAAgBM,IAAhB;AACA;AACH;;AAEDsB,6BAASA,OAAOU,UAAhB;AACH;AACJ,aA1BD;AA2BH;;;kCAEkB;AAAA;;AAAA,gBAAXhC,IAAW,uEAAJ,EAAI;;AACf,gBAAG,CAACA,KAAKrB,OAAT,EAAkBqB,KAAKrB,OAAL,GAAe,GAAf;AAClB,gBAAG,CAACqB,KAAKnB,eAAT,EAA0BmB,KAAKnB,eAAL,GAAuB,GAAvB;AAC1B,gBAAG,CAACmB,KAAKiC,MAAT,EAAiBjC,KAAKiC,MAAL,GAAc,CAAd;AACjB,gBAAG,CAACjC,KAAKjB,cAAT,EAAyB,KAAKA,cAAL,GAAsB,YAAM;AAAE,uBAAKmD,WAAL,CAAiBlC,KAAKiC,MAAtB;AAAgC,aAA9D;;AAEzBnB,qBAASqB,cAAT,CAAwB,KAAK7D,EAA7B,EAAiC8D,KAAjC,CAAuCC,UAAvC,GAAoD,aAAarC,KAAKrB,OAAL,GAAa,IAA1B,GAAiC,YAArF;;AAIAmC,qBAASM,gBAAT,CAA0B,OAA1B,EAAmC,UAACC,CAAD,EAAO;AACtCA,oBAAIA,KAAKhC,OAAOS,KAAhB;AACA,oBAAIwB,SAASD,EAAEC,MAAF,IAAYD,EAAEE,UAA3B;;AAEA;AACA,uBAAMD,MAAN,EAAc;AACV,wBAAIA,kBAAkBE,iBAAtB,EAAyC;AAAA;AACrCxB,iCAAKvB,QAAL,GAAgB6C,OAAOG,UAAP,CAAkB,MAAlB,EAA0BC,KAA1C;AACA,gCAAIC,WAAW3B,KAAKvB,QAAL,CAAcmD,KAAd,CAAoB,GAApB,EAAyB,CAAzB,CAAf;AACA,gCAAG,CAAC,QAAD,EAAW,KAAX,EAAkBC,OAAlB,CAA0BF,QAA1B,MAAwC,CAAC,CAA5C,EAA+C;AAC/C,gCAAGG,WAAW9B,KAAKvB,QAAhB,CAAH,EAA8B;;AAE9B4C,8BAAEU,cAAF;;AAEA,mCAAKG,WAAL,CAAiBlC,KAAKiC,MAAtB;;AAEA,gCAAIK,iBAAiBtC,KAAKpB,QAA1B;AACAoB,iCAAKpB,QAAL,GAAgB,UAAC2D,IAAD,EAAU;AACtB,uCAAKL,WAAL,CAAiB,CAAjB;AACA,oCAAGI,cAAH,EAAmBA,eAAeC,IAAf;AACtB,6BAHD;;AAKA,mCAAKvD,eAAL,GAAuBgB,KAAKpB,QAA5B;;AAEA,mCAAKc,UAAL,CAAgBM,IAAhB;AACA;AAnBqC;;AAAA,8CAmBrC;AACH;;AAEDsB,6BAASA,OAAOU,UAAhB;AACH;AACJ,aA9BD;AAiCH;;;oCAEWC,M,EAAQ;AAChBnB,qBAASqB,cAAT,CAAwB,KAAK7D,EAA7B,EAAiC8D,KAAjC,CAAuCI,OAAvC,GAAiDP,MAAjD;AACH;;;;;;QAGI5D,I,GAAAA,I;;;AAGT,IAAMyD,aAAa,SAAbA,UAAa,CAACjC,GAAD,EAAS;AACxB,QAAI4C,QAAQ5C,IAAI4C,KAAJ,CAAU,4DAAV,CAAZ;AACA,QAAG,OAAOA,MAAM,CAAN,CAAP,KAAoB,QAApB,IAAgCA,MAAM,CAAN,EAASC,MAAT,GAAkB,CAAlD,IAAuDD,MAAM,CAAN,EAASE,WAAT,OAA2BnD,SAASmC,QAA9F,EAAwG,OAAO,IAAP;AACxG,QAAG,OAAOc,MAAM,CAAN,CAAP,KAAoB,QAApB,IAAgCA,MAAM,CAAN,EAASC,MAAT,GAAkB,CAAlD,IAAuDD,MAAM,CAAN,EAASG,OAAT,CAAiB,IAAIC,MAAJ,CAAW,OAAK,EAAC,SAAQ,EAAT,EAAY,UAAS,GAArB,GAA0BrD,SAASmC,QAAnC,CAAL,GAAkD,KAA7D,CAAjB,EAAsF,EAAtF,MAA8FnC,SAASsD,IAAjK,EAAuK,OAAO,IAAP;AACvK,WAAO,KAAP;AACH,CALD","file":"Ocelot.js","sourcesContent":["class Pjax {\n    constructor(el = 'ocelot-content') {\n        // The element to watch\n        this.el = el;\n\n        // Page-specific events\n        this.events = {};\n\n        // Default changePage options\n        this.defaultOpts = {endpoint: false, method: 'GET', timeout: 0, callback: null, callbackTimeout: 0, push: true};\n\n        // Default pop callbacks\n        this.prePopCallback = () => {\n        };\n        this.postPopCallback = null;\n\n        // Register pop state events\n        this.registerPop();\n    }\n\n    registerPop() {\n        let self = this;\n\n        if(history.pushState) {\n            window.onpopstate = () => {\n                let popOpts = {\n                    endpoint : window.location.pathname,\n                    push: false\n                };\n\n                // Change page without pushing new entry to the history\n                if(self.prePopCallback) this.prePopCallback();\n                if(self.postPopCallback) popOpts.callback = this.postPopCallback;\n                self.changePage(popOpts);\n            };\n        } else {\n            console.warn('Ocelot: this browser does not support history.pushState. Hash changing is coming soon.')\n        }\n    }\n\n    setEvent(url, event) {\n        this.events[url] = event;\n    }\n\n    changePage(customOpts = {}) {\n        let opts = this.defaultOpts;\n\n        Object.keys(customOpts).forEach((key) => {\n            opts[key] = customOpts[key];\n        });\n\n        if(!opts.endpoint) console.warn('Ocelot: a PJAX endpoint is required.');\n\n        // AJAX call made to endpoint\n        let xhr = new XMLHttpRequest();\n        xhr.open(opts.method, opts.endpoint, true);\n        xhr.send();\n        xhr.onreadystatechange = () => {\n            if(xhr.readyState !== 4) return;\n            if(xhr.status !== 200) {\n                console.warn(`Ocelot: ${opts.method} ${opts.endpoint} returned ${xhr.status}.`);\n                return;\n            }\n\n            // Set a timeout in case of any transition animations\n            setTimeout(() => {\n                // Get only AJAX-friendly content, we don't want to duplicate the CSS and JavaScript\n                let temp = document.createElement('div');\n                temp.innerHTML = xhr.responseText;\n                document.querySelector(`#${this.el}`).innerHTML = temp.querySelector(`#${this.el}`).innerHTML;\n\n                // Perform any page-specific events\n                let pageEvent = this.events[opts.endpoint];\n                if(pageEvent) {\n                    if(typeof pageEvent !== 'function') {\n                        console.warn(`Ocelot: ${opts.endpoint} event must be a function, instead found ${typeof pageEvent}.`);\n                        return;\n                    }\n                    pageEvent();\n                }\n            }, opts.timeout);\n\n            // Perform callback function (if any)\n            setTimeout(function(){\n                if(opts.callback === null) return;\n                if(typeof opts.callback !== 'function') {\n                    console.warn(`Ocelot: Callback must be a function, instead found ${typeof opts.callback}.`);\n                    return;\n                }\n\n                opts.callback(xhr.responseText);\n            }, opts.callbackTimeout);\n\n            // Push to browser history to allow for back/forward\n            if(opts.push) history.pushState('', 'New URL: ' + opts.endpoint, opts.endpoint);\n        }\n    }\n\n    all(opts = {}) {\n        document.addEventListener(\"click\", (e) => {\n            e = e || window.event;\n            let target = e.target || e.srcElement;\n\n            // Bubble up through the DOM to target links\n            while(target) {\n                if (target instanceof HTMLAnchorElement) {\n                    opts.endpoint = target.attributes[\"href\"].value;\n                    let protocol = opts.endpoint.split(':')[0];\n                    if([\"mailto\", \"tel\"].indexOf(protocol) !== -1) break;\n                    if(isExternal(opts.endpoint)) break;\n\n                    e.preventDefault();\n\n                    if(typeof opts.prePopCallback !== \"function\") {\n                        this.prePopCallback();\n                    } else {\n                        opts.prePopCallback();\n                    }\n\n                    this.changePage(opts);\n                    break;\n                }\n\n                target = target.parentNode;\n            }\n        });\n    }\n\n    fadeAll(opts = {}) {\n        if(!opts.timeout) opts.timeout = 250;\n        if(!opts.callbackTimeout) opts.callbackTimeout = 250;\n        if(!opts.fadeTo) opts.fadeTo = 0;\n        if(!opts.prePopCallback) this.prePopCallback = () => { this.fadeContent(opts.fadeTo); };\n\n        document.getElementById(this.el).style.transition = \"opacity \" + opts.timeout/1000 + \"s ease-out\";\n\n\n\n        document.addEventListener(\"click\", (e) => {\n            e = e || window.event;\n            let target = e.target || e.srcElement;\n\n            // Bubble up through the DOM to target links\n            while(target) {\n                if (target instanceof HTMLAnchorElement) {\n                    opts.endpoint = target.attributes[\"href\"].value;\n                    let protocol = opts.endpoint.split(':')[0];\n                    if([\"mailto\", \"tel\"].indexOf(protocol) !== -1) break;\n                    if(isExternal(opts.endpoint)) break;\n\n                    e.preventDefault();\n\n                    this.fadeContent(opts.fadeTo);\n\n                    let passedCallback = opts.callback;\n                    opts.callback = (data) => {\n                        this.fadeContent(1);\n                        if(passedCallback) passedCallback(data);\n                    };\n\n                    this.postPopCallback = opts.callback;\n\n                    this.changePage(opts);\n                    break;\n                }\n\n                target = target.parentNode;\n            }\n        });\n\n\n    }\n\n    fadeContent(fadeTo) {\n        document.getElementById(this.el).style.opacity = fadeTo;\n    };\n}\n\nexport { Pjax };\n\n\nconst isExternal = (url) => {\n    let match = url.match(/^([^:\\/?#]+:)?(?:\\/\\/([^\\/?#]*))?([^?#]+)?(\\?[^#]*)?(#.*)?/);\n    if(typeof match[1] === \"string\" && match[1].length > 0 && match[1].toLowerCase() !== location.protocol) return true;\n    if(typeof match[2] === \"string\" && match[2].length > 0 && match[2].replace(new RegExp(\":(\"+{\"http:\":80,\"https:\":443}[location.protocol]+\")?$\"), \"\") !== location.host) return true;\n    return false;\n};"]}